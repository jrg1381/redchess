@using RedChess.WebEngine.Models
@model int

@section head
{
    <link rel="stylesheet" type="text/css" href="/Scripts/app/viewer.css"/>
    <script src="/Scripts/app/boardviewer.js" type="text/javascript"></script>
}

    @{
        ViewBag.Title = "History";
    }

<script>
    $(document).ready(function () {
        var cfg = { pieceTheme: '/Images/{piece}.png', position: '', showNotation: false };
        var board = new ChessBoard('board', cfg);
        var emptyData = { Moves: [{ Fen: "", Move: "" }], Description: "", IsParticipant: false };
        var boardViewer = new BoardViewer(emptyData, board);
        boardViewer.startSpinning();

        $.getJSON("/api/Moves/@Model")
            .always(function() {
                boardViewer.stopSpinning();
            })
        .done(function (data) {
            boardViewer = new BoardViewer(data, board);

            var evaluationData = data.Analysis.map(function(x) { return x.Evaluation; });

            $('#title').text(data.Description);
            $('span#desc').text(data.Description);
            $("#pgn-button").click(function() {
                location.href = "/History/Pgn/@Model";
            });
        }).fail(function (jqXHR, textStatus, errorThrown) {
            $('span#desc').text(jqXHR.status + " " + errorThrown);
            $("table#moves").append("<tr><td>" + jqXHR.responseJSON.message + "</td></tr>");
            $("table#moves").append("<tr><td>" + jqXHR.responseJSON.messageDetail + "</td></tr>");
            $("#pgn-button").hide();
        });
    });
</script>
<div class="row">
    <div class="col-lg-3" id="spinner-location">
    </div>
</div>
    <div class="row">
        <div class="col-lg-3">
            <div class="panel panel-default">
                <div class="panel-heading"><span id="desc"></span> <div class="pull-right btn btn-xs btn-primary" id="pgn-button">PGN</div></div>
                <div id="scrollbox" class="panel-body pre-scrollable" style="max-height: 465px">
                    <table id="moves"></table>
                </div>
            </div>
        </div>
        <div class="col-lg-7">
            <div id="board"></div>
        </div>
    </div>
<div class="row">
    <div class="col-lg-3">

    </div>
    <div class="col-lg-7">
        <div style="width: 512px">
            <div class="wrapper"><span class="button" id="goStart"></span></div>
            <div class="wrapper"><span class="button" id="goBack"></span></div>
            <div class="wrapper"><span class="button" id="playFromHere" title="Play from here"></span></div>
            <div class="wrapper"><span class="button" id="goFlip"></span></div>
            <div class="wrapper"><span class="button" id="goEnd"></span></div>
            <div class="wrapper"><span class="button" id="goForward"></span></div>
        </div>
    </div>

</div>


